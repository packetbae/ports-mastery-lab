<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Common Ports — Ports Mastery</title>
<meta name="color-scheme" content="light dark"/>
<style>
  :root{
    --bg:#f0f0f2;--fg:#0f1115;--muted:#6b6f76;--card:#ffffff;--accent:#0a84ff;
    --radius:18px;--shadow:0 10px 28px rgba(0,0,0,.08);--border:1px solid rgba(0,0,0,.06);
    --ok:#1d9f49;--bad:#ff3b30;--line:#d2d2d7;
  }
  @media (prefers-color-scheme: dark){
    :root{--bg:#121416;--fg:#f4f5f7;--muted:#9aa0a6;--card:#1a1c1f;--accent:#3b9cff;--border:1px solid rgba(255,255,255,.08);--line:#2b2f35}
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}

  /* Header */
  header{position:sticky;top:0;z-index:20;background:var(--bg);border-bottom:var(--border)}
  .nav{max-width:1120px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;gap:10px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 4px rgba(10,132,255,.18)}
  .spacer{flex:1}
  .btn, .chip, select{
    background:transparent;border:var(--border);border-radius:999px;padding:8px 14px;color:inherit;
    text-decoration:none;font-weight:600;cursor:pointer
  }

  /* Sticky scenario toolbar (better on iPhone) */
  .toolbar{
    position:sticky; top:56px; z-index:15;
    background:var(--bg); border-bottom:var(--border);
  }
  .toolbar .wrap{
    max-width:1120px;margin:0 auto;padding:10px 20px;display:flex;gap:8px;align-items:center;flex-wrap:wrap
  }
  .toolbar select,.toolbar button{border-radius:12px}

  /* Main */
  main{max-width:1120px;margin:0 auto;padding:22px 20px 80px}
  h1{font-size:36px;letter-spacing:-.2px;margin:6px 0 8px}
  .lead{margin:0 0 12px;color:var(--muted)}
  .panel{border:var(--border);background:var(--card);border-radius:20px;padding:18px;box-shadow:var(--shadow)}
  .grid{display:grid;grid-template-columns:repeat(4,minmax(220px,1fr));gap:12px;margin-top:12px}
  .box{background:var(--card);border:var(--border);border-radius:12px;padding:12px}
  .box label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
  input[type="number"], select{width:100%;padding:10px;border:var(--border);border-radius:10px;background:var(--card);color:inherit}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .chip input{accent-color:var(--accent)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .result{font-weight:800;margin-top:6px}
  .ok{color:var(--ok)} .no{color:var(--bad)}
  .good input,.good select{border-color:var(--ok);box-shadow:inset 0 0 0 9999px rgba(29,159,73,.08)}
  .bad  input,.bad  select{border-color:var(--bad);box-shadow:inset 0 0 0 9999px rgba(255,59,48,.08)}
  mark.hl-ok{background:rgba(255,235,59,.4);border-radius:2px;padding:0 2px;color:inherit}
  .explain{color:var(--muted);white-space:pre-line;margin-top:8px}
  .kgrid{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:8px;margin-top:8px}
  .k{background:var(--card);border:var(--border);border-radius:10px;padding:10px}
  .k b{display:block;margin-bottom:4px}
  .extras{margin-top:10px;display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:8px}
  .extra{border:var(--border);background:var(--card);border-radius:10px;padding:10px}
  .extra b{display:block;margin-bottom:4px}
  footer{max-width:1120px;margin:40px auto 60px;padding:0 20px;color:var(--muted);font-size:13px}

  @media (max-width:960px){
    .grid{grid-template-columns:1fr}
    h1{font-size:28px}
    .kgrid,.extras{grid-template-columns:1fr}
    .toolbar{top:54px}
  }
</style>
</head>
<body>
<header>
  <div class="nav">
    <a class="btn" href="../index.html" aria-label="Back">←</a>
    <div class="brand"><span class="dot" aria-hidden="true"></span><span>Common Ports</span></div>
    <span class="spacer"></span>
    <!-- header kept clean; selector moved to sticky toolbar below -->
  </div>
</header>

<!-- Sticky scenario toolbar (always visible under header, good on iPhone) -->
<div class="toolbar" role="region" aria-label="Scenario controls">
  <div class="wrap">
    <label for="scenarioSel" class="sr-only" style="position:absolute;left:-9999px">Choose Scenario</label>
    <select id="scenarioSel" title="Choose Scenario"></select>
    <button class="btn" id="prevBtn" aria-label="Previous">◀</button>
    <button class="btn" id="nextBtn" aria-label="Next">▶</button>
    <span style="flex:1"></span>
    <button class="btn" id="revealBtn">Reveal</button>
    <button class="btn" id="checkBtn">Check</button>
    <button class="btn" id="resetBtn">Reset</button>
    <button class="btn" id="shuffleBtn">Shuffle</button>
  </div>
</div>

<main>
  <h1>Common Ports</h1>
  <p class="lead">Exam-style prompt: choose the correct <b>port number</b>, <b>transport</b> (TCP/UDP/Both), <b>security</b>, and <b>service</b>. Then <b>Check</b> or <b>Reveal</b>.</p>

  <section class="panel" id="pbq">
    <h2 id="title" style="margin:0 0 6px">Loading…</h2>
    <p id="desc" data-orig="" style="margin:0 0 12px"></p>

    <div class="grid">
      <div class="box" id="bPort">
        <label for="portInput">Port Number</label>
        <input id="portInput" type="number" min="1" max="65535" placeholder="e.g., 443"/>
      </div>

      <div class="box" id="bTransport">
        <label>Transport</label>
        <div class="row" role="radiogroup" aria-label="Transport">
          <label class="chip"><input type="radio" name="transport" value="TCP">TCP</label>
          <label class="chip"><input type="radio" name="transport" value="UDP">UDP</label>
          <label class="chip"><input type="radio" name="transport" value="Both">Both</label>
        </div>
      </div>

      <div class="box" id="bSecure">
        <label>Security</label>
        <div class="row" role="radiogroup" aria-label="Security">
          <label class="chip"><input type="radio" name="secure" value="Yes">Secure</label>
          <label class="chip"><input type="radio" name="secure" value="No">Not Secure</label>
        </div>
      </div>

      <div class="box" id="bService">
        <label for="serviceSel">Service Name</label>
        <select id="serviceSel">
          <option value="">Select service…</option>
          <option>HTTP</option><option>HTTPS</option><option>SSH</option><option>Telnet</option>
          <option>FTP</option><option>FTPS</option><option>SFTP</option>
          <option>SMTP</option><option>Submission (SMTP)</option><option>SMTPS</option>
          <option>POP3</option><option>POP3S</option><option>IMAP</option><option>IMAPS</option>
          <option>DNS</option><option>DHCP</option><option>TFTP</option>
          <option>SNMP</option><option>Syslog</option><option>NTP</option>
          <option>Kerberos</option><option>LDAP</option><option>LDAPS</option>
          <option>SMB</option><option>RDP</option>
          <option>SIP</option>
          <option>MySQL</option><option>MSSQL</option><option>PostgreSQL</option><option>Oracle DB</option>
          <option>RADIUS</option><option>TACACS+</option>
          <option>IKE/IPsec</option><option>L2TP</option><option>PPTP</option>
          <option>DoT (DNS over TLS)</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button class="btn" id="checkBtn2">Check</button>
      <button class="btn" id="revealBtn2">Reveal</button>
      <button class="btn" id="resetBtn2">Reset</button>
      <div id="score" class="result"></div>
    </div>

    <div id="explain" class="explain"></div>
    <div class="extras">
      <div class="extra" id="mnemo"><b>Mnemonic</b><div id="mnemoText" class="muted"></div></div>
      <div class="extra" id="story"><b>Sticky fact</b><div id="storyText" class="muted"></div></div>
    </div>
    <div id="kmeta" class="kgrid" aria-live="polite"></div>
  </section>
</main>

<footer>© <span id="year"></span> packetbae — All Rights Reserved</footer>

<script>
// ---------- Utilities ----------
function setPristine(p, text){ p.dataset.orig = text; p.innerHTML = text; }
function highlight(p, terms){
  let html = p.dataset.orig || p.innerHTML;
  (terms||[]).filter(Boolean).sort((a,b)=>b.length-a.length).forEach(t=>{
    const esc = t.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    html = html.replace(new RegExp('(' + esc + ')','gi'),'<mark class="hl-ok">$1</mark>');
  });
  p.innerHTML = html;
}
function decorate(el, ok){ el.classList.remove('good','bad'); el.classList.add(ok?'good':'bad'); }
function getRadio(name){ const el = document.querySelector('input[name="'+name+'"]:checked'); return el?el.value:""; }
function setRadio(name,val){ document.querySelectorAll('input[name="'+name+'"]').forEach(r=>r.checked=(r.value===val)); }
function clearRadios(name){ document.querySelectorAll('input[name="'+name+'"]').forEach(r=>r.checked=false); }

// ---------- Data helpers ----------
function A(port, transport, secure, service){ return { port:String(port), transport, secure, service }; }
function M(fn, keep, when){ return { fn, keep, when }; }
function S(title, text, cues, ans, proto, meta){ return { title, text, cues, ans, proto, meta }; }

// ---------- Mnemonics & sticky facts ----------
const MNEMONICS = {
  "HTTPS":"4-4-3 = three locks.",
  "HTTP":"The open ‘80s web.",
  "SSH":"Two keys to a Secure SHell (22).",
  "Telnet":"23 is “too free” (cleartext).",
  "TFTP":"Simple 69 (no auth).",
  "LDAP":"389 starts TLS (STARTTLS).",
  "LDAPS":"Dedicated TLS on 636.",
  "DNS":"5 + 3 = D-N-S.",
  "NTP":"1-2-3… keep time with me.",
  "Submission (SMTP)":"5-8-7: send, auth, encrypt.",
  "SMTP":"25 to deliver mail (server relay).",
  "POP3S":"995 = POP over TLS.",
  "IMAPS":"993 = IMAP over TLS.",
  "IMAP":"1-4-3: IMAP I-mail-3.",
  "SFTP":"Same as SSH: 22.",
  "FTPS":"FTP leveled up: 990.",
  "RDP":"33-8-9 = 3D screen (remote desktop).",
  "SMB":"Windows shares: 4-4-5.",
  "SNMP":"Poll 161, trap 162.",
  "Syslog":"514: UDP by default, TCP exists.",
  "Kerberos":"Tickets need time; NTP matters.",
  "IKE/IPsec":"Half-a-thousand to start the tunnel (500).",
  "SIP":"5060: signaling sans TLS.",
  "MySQL":"33-0-6: ‘My’ data mix."
};

const FACTS = {
  "HTTPS":"“Not Secure” warnings pushed the web to 443; HSTS & free certs (e.g., Let’s Encrypt) accelerated the shift. Mixed-content and downgrade issues remain if 80 isn’t redirected.",
  "HTTP":"Cleartext on 80 exposes cookies and credentials on open Wi-Fi; best practice is 80→443 with HSTS to prevent downgrade.",
  "SSH":"Internet scans constantly brute-force 22; disable passwords and use keys + fail2ban. Same port for SFTP/SCP.",
  "Telnet":"Many IoT compromises abused Telnet with default creds; retire it and use SSH instead.",
  "TFTP":"Open TFTP servers have leaked PXE images and configs; limit to provisioning VLANs and block at the edge.",
  "LDAP":"Unsigned/clear binds on 389 can expose credentials; use STARTTLS or LDAPS and restrict anonymous binds.",
  "LDAPS":"Stable, encrypted alternative to LDAP; certificate trust and hostname validation are common misconfig causes.",
  "DNS":"Open resolvers are abused for amplification; zone transfers (TCP) should be limited to authorized servers.",
  "NTP":"Reflection DDoS abused legacy ‘monlist’; restrict to internal clients or authenticated sources.",
  "Submission (SMTP)":"Clients should use 587 with auth; many ISPs block outbound 25 to reduce spam from infected hosts.",
  "SMTP":"Misconfigured open relays on 25 are classic spam vectors; edge gateways restrict who can relay.",
  "POP3S":"POP downloads then deletes; TLS protects creds in transit. Prefer IMAP for multi-device access.",
  "IMAPS":"IMAPS starts encrypted; avoids STARTTLS stripping on hostile networks.",
  "IMAP":"Cleartext IMAP can leak creds; either upgrade with STARTTLS or move to 993.",
  "SFTP":"Same security model as SSH; you can chroot users and key-restrict commands for safer automations.",
  "FTPS":"Firewall pinholes for passive data ports are a common hurdle; document the passive range.",
  "RDP":"Exposed 3389 is a common ransomware entry via brute force; use NLA, MFA, and VPN or jump hosts.",
  "SMB":"WannaCry exploited SMBv1; disable SMBv1, segment networks, and avoid exposing 445 to the internet.",
  "SNMP":"Default community ‘public’ is still found; use SNMPv3 with authPriv or disable.",
  "Syslog":"UDP/514 can drop under load; TCP or TLS versions improve integrity and reliability.",
  "Kerberos":"Time skew breaks tickets; keep NTP healthy. Golden-ticket abuse targets KDCs—protect them.",
  "IKE/IPsec":"Credential stuffing on VPN gateways is common; enforce MFA and strong cipher suites.",
  "SIP":"Exposed PBXs on 5060 see registration brute-force and toll fraud; prefer TLS and SBCs.",
  "MySQL":"Publicly exposed 3306 leads to data theft and ransomware; bind to internal addresses and require TLS."
};

// ---------- Exam-style scenarios (24) ----------
const SCENARIOS = [
  S("Secure web access required",
    "A public payment portal must present a padlock in modern browsers. HTTP (80) must redirect, but the primary listener must be the standard encrypted web port. Which port/transport/service is correct?",
    ["TLS","padlock","redirect","encrypted web"],
    A(443,"TCP","Yes","HTTPS"),"TCP",M("Encrypted web browsing.","Yes (edge)","External web apps; force 80→443.")),
  S("Legacy cleartext admin (temporary)",
    "An older appliance only supports plain web for admin and cannot negotiate TLS. From a jump segment, allow the historical cleartext web port temporarily. Which option matches this requirement?",
    ["plain web","no TLS","historical web"],
    A(80,"TCP","No","HTTP"),"TCP",M("Unencrypted web.","Prefer redirect to 443","Temporary legacy access.")),
  S("Remote shell to Linux bastion",
    "Operations require a cryptographic remote shell with key-pair login. Port forwarding and SCP must function over the same protocol. Choose the appropriate default port/transport/service.",
    ["cryptographic","key pairs","SCP","tunneling"],
    A(22,"TCP","Yes","SSH"),"TCP",M("Secure shell & tunneling.","Scoped internal/edge","Admin access, Git, SFTP/SCP.")),
  S("Plain terminal session (discouraged)",
    "A vendor requests a one-off plaintext terminal session to a router. Security allows only the default cleartext terminal port for the maintenance window. What should be configured?",
    ["plaintext","terminal"],
    A(23,"TCP","No","Telnet"),"TCP",M("Plain terminal.","Block; use SSH","Only if forced; migrate.")),
  S("PXE imaging via trivial server",
    "Imaging clients must download boot files from a trivial file service with no authentication on the provisioning VLAN. Select the correct port and protocol.",
    ["trivial","UDP","PXE"],
    A(69,"UDP","No","TFTP"),"UDP",M("Trivial file transfer.","Internal PXE only","PXE boot, firmware staging.")),
  S("Directory with STARTTLS (not LDAPS)",
    "Apps perform directory binds on the historical port and upgrade with STARTTLS when supported. Do not use the dedicated SSL port. What mapping is correct?",
    ["STARTTLS","historical port"],
    A(389,"Both","No","LDAP"),"Both",M("Directory lookups.","Internal only","AD/LDAP queries.")),
  S("Partner requires LDAPS",
    "A partner mandates encrypted directory queries end-to-end using the dedicated TLS port. Choose the correct configuration.",
    ["encrypted directory","dedicated TLS"],
    A(636,"TCP","Yes","LDAPS"),"TCP",M("LDAP over TLS.","Scoped partner/internal","Directory queries with TLS.")),
  S("Resolver traffic and transfers",
    "Allow name resolution for clients. Most queries are connectionless, but zone transfers must work using the same well-known number. Which selection fits?",
    ["queries","zone transfers","connectionless"],
    A(53,"Both","No","DNS"),"Both",M("Name resolution.","Edge allowed; filter","UDP queries, TCP transfers.")),
  S("Keep clocks in sync",
    "Domain members must synchronize time using the standard lightweight protocol over UDP. Open the correct port on the time sources only. What is it?",
    ["UDP","clocks","time source"],
    A(123,"UDP","No","NTP"),"UDP",M("Time sync.","Internal; restrict","Domain time, log correlation.")),
  S("Client mail submission",
    "User mail clients should send through the gateway using the modern submission port with authentication and STARTTLS, not the server-to-server relay port. Choose the right mapping.",
    ["submission","auth","STARTTLS"],
    A(587,"TCP","Yes","Submission (SMTP)"),"TCP",M("Client→server submission.","Mail edge","MUAs sending outbound mail.")),
  S("Server mail relay",
    "Permit server-to-server email transport on the traditional MTA relay port on the edge relay only. Which option is correct?",
    ["server-to-server","relay"],
    A(25,"TCP","No","SMTP"),"TCP",M("MTA relay.","Mail edge only","MTA↔MTA transport.")),
  S("Encrypted POP retrieval",
    "Traveling users must download mail with POP wrapped in TLS from connection start. Select the correct default.",
    ["download","TLS from start"],
    A(995,"TCP","Yes","POP3S"),"TCP",M("Secure POP.","Mail edge if used","POP clients over TLS.")),
  S("Encrypted IMAP from start",
    "Mobile users require mailbox synchronization encrypted from the first packet (not STARTTLS). Choose the well-known secure port.",
    ["encrypted from start","mailbox sync"],
    A(993,"TCP","Yes","IMAPS"),"TCP",M("Secure IMAP.","Mail edge if used","IMAP over TLS.")),
  S("Legacy IMAP device",
    "A legacy scanner reads a drop inbox but only supports cleartext IMAP. Allow the historical port temporarily. Which is correct?",
    ["legacy","cleartext IMAP"],
    A(143,"TCP","No","IMAP"),"TCP",M("IMAP (clear).","Prefer block","Migrate to TLS.")),
  S("SFTP over SSH channel",
    "Data extracts move nightly using SFTP, leveraging the same secure channel as remote shell. Pick the default.",
    ["SFTP","SSH channel"],
    A(22,"TCP","Yes","SFTP"),"TCP",M("File transfer over SSH.","Scoped","Automated secure transfers.")),
  S("FTPS (explicit TLS)",
    "A partner requires FTP with explicit TLS on the control channel rather than SFTP. Choose the FTPS control port.",
    ["explicit TLS","FTPS control"],
    A(990,"TCP","Yes","FTPS"),"TCP",M("FTP with TLS.","Partner edge","B2B transfers.")),
  S("Remote Desktop access",
    "Helpdesk connects to Windows servers using the graphical remote protocol. Allow only the standard TCP port from the support subnet. Which is correct?",
    ["graphical remote"],
    A(3389,"TCP","Yes","RDP"),"TCP",M("Remote desktop.","Internal scoped","Admin/jump hosts.")),
  S("SMB in AD environment",
    "Windows clients access file shares directly (no NetBIOS). Permit the modern direct host port. What should you choose?",
    ["SMB","direct"],
    A(445,"TCP","No","SMB"),"TCP",M("File/print sharing.","Block edge","Shares, AD ops.")),
  S("SNMP monitoring",
    "Monitoring polls network devices using the classic management protocol. Permit the query port on UDP; traps use a nearby number. Which mapping is correct?",
    ["polls","management","UDP"],
    A(161,"UDP","No","SNMP"),"UDP",M("Monitoring.","Internal only (v3)","NMS polling.")),
  S("Syslog to SIEM",
    "Appliances forward events to the collector using the default syslog port. Transport security is handled separately. Choose the correct option.",
    ["events","collector"],
    A(514,"Both","No","Syslog"),"Both",M("Event transport.","Internal","Logs to SIEM.")),
  S("Kerberos tickets",
    "Domain clients and controllers exchange service tickets over the well-known Kerberos port, using either transport as required. Pick the correct mapping.",
    ["tickets","domain"],
    A(88,"Both","Yes","Kerberos"),"Both",M("Authentication.","Internal","Logon/service auth.")),
  S("IPsec IKE negotiation",
    "Allow Internet Key Exchange for IPsec peers; the first phase uses a fixed UDP port before NAT-T. Which one?",
    ["IKE","IPsec","UDP"],
    A(500,"UDP","Yes","IKE/IPsec"),"UDP",M("IPsec phase 1.","VPN edge","Site-to-site/remote.")),
  S("VoIP signaling without TLS",
    "Phones register to the call manager over standard SIP signaling without TLS; media uses RTP separately. Select the correct default.",
    ["SIP","signaling","RTP"],
    A(5060,"Both","No","SIP"),"Both",M("VoIP signaling.","Provider/internal","Registration/call setup.")),
  S("MySQL backend",
    "The application tier reaches the relational database over its default port. No UDP is involved; TLS may be enabled by the connector. Choose the correct mapping.",
    ["database","default"],
    A(3306,"TCP","No","MySQL"),"TCP",M("RDBMS connections.","Internal","App→DB."))
];

// ---------- DOM refs ----------
const tTitle = document.getElementById('title');
const tDesc  = document.getElementById('desc');
const portInput = document.getElementById('portInput');
const serviceSel = document.getElementById('serviceSel');
const bPort = document.getElementById('bPort');
const bTransport = document.getElementById('bTransport');
const bSecure = document.getElementById('bSecure');
const bService = document.getElementById('bService');
const scoreEl = document.getElementById('score');
const explainEl = document.getElementById('explain');
const kmetaEl = document.getElementById('kmeta');
const scenarioSel = document.getElementById('scenarioSel');
const mnemoText = document.getElementById('mnemoText');
const storyText = document.getElementById('storyText');

// ---------- Logic ----------
let IDX = 0;
const titleFor = (i,t)=> (i+1)+') '+t;

function clearAll(){
  portInput.value="";
  ["transport","secure"].forEach(clearRadios);
  serviceSel.value="";
  [bPort,bTransport,bSecure,bService].forEach(b=>b.classList.remove('good','bad'));
  scoreEl.textContent=""; scoreEl.className="result";
  explainEl.textContent=""; kmetaEl.innerHTML="";
  mnemoText.textContent=""; storyText.textContent="";
  setPristine(tDesc, tDesc.dataset.orig || tDesc.innerHTML);
}

function loadScenario(i){
  IDX = Math.max(0, Math.min(SCENARIOS.length-1, i));
  const s = SCENARIOS[IDX];
  tTitle.textContent = titleFor(IDX, s.title);
  setPristine(tDesc, s.text);
  clearAll();
  scenarioSel.value = String(IDX);
}

function showMeta(s){
  kmetaEl.innerHTML =
    '<div class="k"><b>Function</b>'+s.meta.fn+'</div>'+
    '<div class="k"><b>Keep Open?</b>'+s.meta.keep+'<div style="margin-top:6px"><b>Typical Use</b><br/>'+s.meta.when+'</div></div>';
}

function addMemoryAids(s){
  const key = s.ans.service;
  mnemoText.textContent = MNEMONICS[key] || '';
  storyText.textContent = FACTS[key] || '';
}

function check(){
  const s = SCENARIOS[IDX];
  const chosen = {
    port: String(portInput.value || ''),
    transport: getRadio('transport'),
    secure: getRadio('secure'),
    service: serviceSel.value
  };
  const ok1 = chosen.port === s.ans.port;
  const ok2 = chosen.transport === s.ans.transport;
  const ok3 = chosen.secure === s.ans.secure;
  const ok4 = chosen.service === s.ans.service;
  decorate(bPort, ok1); decorate(bTransport, ok2); decorate(bSecure, ok3); decorate(bService, ok4);
  const allOk = ok1 && ok2 && ok3 && ok4;
  scoreEl.textContent = allOk ? 'Correct' : 'Try again';
  scoreEl.className = 'result ' + (allOk ? 'ok' : 'no');
  highlight(tDesc, s.cues);
  explainEl.textContent =
    'Answer:\n• Port: ' + s.ans.port +
    '\n• Transport: ' + s.ans.transport +
    '\n• Secure: ' + s.ans.secure +
    '\n• Service: ' + s.ans.service +
    '\n• Native Protocol: ' + s.proto;
  showMeta(s);
  addMemoryAids(s);
}

function reveal(){
  const s = SCENARIOS[IDX];
  portInput.value = s.ans.port;
  setRadio('transport', s.ans.transport);
  setRadio('secure', s.ans.secure);
  serviceSel.value = s.ans.service;
  [bPort,bTransport,bSecure,bService].forEach(b=>decorate(b,true));
  scoreEl.textContent = 'Revealed';
  scoreEl.className = 'result ok';
  highlight(tDesc, s.cues);
  explainEl.textContent =
    'Answer:\n• Port: ' + s.ans.port +
    '\n• Transport: ' + s.ans.transport +
    '\n• Secure: ' + s.ans.secure +
    '\n• Service: ' + s.ans.service +
    '\n• Native Protocol: ' + s.proto;
  showMeta(s);
  addMemoryAids(s);
}

function shuffle(){
  for(let i=SCENARIOS.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [SCENARIOS[i],SCENARIOS[j]]=[SCENARIOS[j],SCENARIOS[i]];
  }
  scenarioSel.innerHTML = SCENARIOS.map((s,i)=>'<option value="'+i+'">'+titleFor(i,s.title)+'</option>').join('');
  loadScenario(0);
}

function next(){ loadScenario(Math.min(IDX+1, SCENARIOS.length-1)); }
function prev(){ loadScenario(Math.max(IDX-1, 0)); }

// Wire events
['checkBtn','checkBtn2'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('click',check); });
['revealBtn','revealBtn2'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('click',reveal); });
['resetBtn','resetBtn2'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('click',()=>loadScenario(IDX)); });
const sh=document.getElementById('shuffleBtn'); if(sh) sh.addEventListener('click',shuffle);
scenarioSel.addEventListener('change',e=>loadScenario(Number(e.target.value)));
document.getElementById('nextBtn').addEventListener('click',next);
document.getElementById('prevBtn').addEventListener('click',prev);

// Init
scenarioSel.innerHTML = SCENARIOS.map((s,i)=>'<option value="'+i+'">'+titleFor(i,s.title)+'</option>').join('');
loadScenario(0);
document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
